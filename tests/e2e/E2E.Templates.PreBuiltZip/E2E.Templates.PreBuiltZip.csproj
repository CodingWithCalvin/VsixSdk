<!--
  E2E.Templates.PreBuiltZip - Tests VsixTemplateZip with pre-built zip files.

  Validates:
  - Pre-built zips included in VSIX
  - TemplateType metadata routes to correct folder
  - Auto-discovery disabled works
-->
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <Version>1.0.0</Version>
    <!-- Disable auto-discovery - we're using pre-built zips -->
    <EnableDefaultVsixTemplateItems>false</EnableDefaultVsixTemplateItems>
    <!-- Exclude template source files from compilation (they contain VS template placeholders) -->
    <DefaultItemExcludes>$(DefaultItemExcludes);TemplateSource\**</DefaultItemExcludes>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.VisualStudio.SDK" Version="17.*" />
  </ItemGroup>

  <ItemGroup>
    <VsixTemplateZip Include="PreBuilt\PreBuiltProject.zip" TemplateType="Project" />
    <VsixTemplateZip Include="PreBuilt\PreBuiltItem.zip" TemplateType="Item" />
  </ItemGroup>

  <!--
    Target to create pre-built zips from source folders if they don't exist.
    In a real scenario, these zips would already exist from another build process.
  -->
  <Target Name="CreatePreBuiltZips" BeforeTargets="PrepareForBuild">
    <MakeDir Directories="PreBuilt" Condition="!Exists('PreBuilt')" />

    <ZipDirectory SourceDirectory="TemplateSource\ProjectTemplate"
                  DestinationFile="PreBuilt\PreBuiltProject.zip"
                  Overwrite="true"
                  Condition="Exists('TemplateSource\ProjectTemplate') and !Exists('PreBuilt\PreBuiltProject.zip')" />

    <ZipDirectory SourceDirectory="TemplateSource\ItemTemplate"
                  DestinationFile="PreBuilt\PreBuiltItem.zip"
                  Overwrite="true"
                  Condition="Exists('TemplateSource\ItemTemplate') and !Exists('PreBuilt\PreBuiltItem.zip')" />
  </Target>

</Project>
